# Розділ 9: Нефункціональні вимоги

Нефункціональні вимоги (NFRs) визначають стандарти якості, продуктивності та надійності системи. Вони є не менш важливими, ніж функціональні вимоги, оскільки забезпечують позитивний користувацький досвід та довгострокову життєздатність продукту.

## 9.1. Продуктивність (Performance)

Застосунок має бути швидким та відгукливим як на десктопних, так і на мобільних пристроях з повільним з'єднанням. Для досягнення цього ми будемо використовувати рендеринг на сервері (Next.js Server Components) для швидкого початкового завантаження та оптимізувати запити до бази даних.

| Метрика | Target | Acceptable | Critical |
|---|---|---|---|
| **Web (Desktop)** | | | |
| FCP (First Contentful Paint) | <1.5s | <2.5s | >3s |
| LCP (Largest Contentful Paint) | <2s | <3s | >4s |
| TTI (Time to Interactive) | <2.5s | <4s | >5s |
| **Mobile (3G)** | | | |
| FCP | <2.5s | <4s | >5s |
| LCP | <3s | <4.5s | >6s |
| TTI | <4s | <6s | >8s |
| **API Response** | | | |
| Читання (GET) | <100ms | <300ms | >500ms |
| Запис (POST/PUT) | <200ms | <500ms | >1s |
| **Offline Sync** | | | |
| Локальне збереження | <50ms | <100ms | >200ms |
| Синхронізація (10 змін) | <2s | <5s | >10s |

## 9.2. Масштабованість (Scalability)

Архітектура спроєктована для поступового масштабування, починаючи з безкоштовних ресурсів і закінчуючи потужними виділеними серверами.

*   **Вертикальна масштабованість:** Можливість переходу на більш потужні тарифні плани Vercel та Supabase.
*   **Горизонтальна масштабованість:** Безсерверна архітектура Next.js та Supabase дозволяє автоматично обробляти сплески трафіку. У майбутньому, на власних серверах, це означатиме запуск кількох екземплярів застосунку за балансувальником навантаження.
*   **Масштабованість бази даних:** По мірі зростання обсягу даних будуть застосовані стратегії шардингу (по `workspace_id`) та використання реплік для читання.

**Ліміти для тарифіфв:**

| Показник | Free Tier (MVP) | Paid Tier |
|---|---|---|
| Користувачів на workspace | до 5 | до 100 |
| Клієнтів | до 1,000 | до 100,000 |
| Угод | до 500 | до 50,000 |
| Файлів | до 1GB | до 100GB |

## 9.3. Доступність та Надійність (Availability & Reliability)

Система має бути надійною. На етапі MVP ми покладаємося на високу доступність Vercel та Supabase, але не надаємо фінансових гарантій (SLA).

| Рівень | Uptime SLA (цільовий) | Максимальний простий/міс | Підтримка |
|---|---|---|---|
| Free | 95% (best effort) | ~36 год | Спільнота |
| Starter | 99% | ~7 год | Email 48 год |
| Pro | 99.5% | ~3.5 год | Email 24 год |
| Enterprise | 99.9% | ~43 хв | Пріоритетна + Телефон |

*   **Stateless Архітектура:** Серверна частина додатку є "stateless" (не зберігає стан між запитами). Це означає, що у випадку збою будь-який екземпляр сервісу може обробити наступний запит, що значно підвищує відмовостійкість.
*   **Резервне копіювання:** База даних у Supabase автоматично отримує щоденні резервні копії, що дозволяє відновити дані у випадку серйозного збою.
*   **Запобігання "засинанню":** Для уникнення простоїв, пов'язаних із "засинанням" безкоштовних інстанцій (Supabase може призупинити проєкт після тижня неактивності), буде налаштовано періодичний "пінг" системи через зовнішній моніторинговий сервіс.

## 9.4. Безпека (Security)

Безпека даних є найвищим пріоритетом. Ми реалізуємо багаторівневий захист, щоб гарантувати конфіденційність та цілісність даних наших клієнтів.

*   **Ізоляція даних на рівні бази даних:** В основі нашої моделі безпеки лежить механізм **Row-Level Security (RLS)** в PostgreSQL. Кожна таблиця з даними клієнтів має політику, яка жорстко прив'язує кожен рядок до конкретної організації (`workspace_id`). Це гарантує, що навіть у випадку логічної помилки в коді, один користувач ні за яких обставин не зможе отримати доступ до даних іншої організації.

*   **Захищена автентифікація та авторизація:**
    *   **Автентифікація:** Ми використовуємо надійні методи, такі як Email + пароль (з вимогами до складності) та OAuth2 (Google). У майбутньому буде додано двофакторну автентифікацію (2FA).
    *   **Авторизація:** Для керування сесіями використовуються **JWT-токени**, які зберігаються в захищених `HttpOnly` cookie. Кожен запит на сервері перевіряє валідність токена та права доступу користувача (`role`) перед виконанням операції.

*   **Шифрування:** Усі дані шифруються як під час передачі (**TLS 1.3**), так і при зберіганні (стандартні механізми шифрування дисків у хмарних провайдерів).

*   **Захист від поширених веб-вразливостей:**
    *   **SQL Injection:** Повністю виключено завдяки використанню параметризованих запитів через Supabase SDK.
    *   **XSS (Cross-Site Scripting):** Фреймворк Next.js автоматично екранує дані при рендерингу в React-компонентах. Ми також ніколи не рендеримо сирий HTML, отриманий від користувача.
    *   **CSRF (Cross-Site Request Forgery):** Вбудовані механізми захисту Next.js та використання патерну Server Actions мінімізують цей ризик.
    *   **CSP (Content Security Policy):** Буде налаштована жорстка політика безпеки контенту, яка обмежить завантаження ресурсів (скриптів, стилів) лише з довірених джерел.

*   **Управління секретами:** Усі ключі API, паролі до баз даних та інші секрети зберігаються у змінних середовища на Vercel та в захищеному сховищі Supabase. Вони ніколи не потрапляють у клієнтський код.

## 9.5. Юзабіліті та Доступність (Usability & Accessibility)

*   **Mobile-first:** Інтерфейс проектується спершу для мобільних пристроїв. Усі ключові функції доступні з телефону, а елементи керування мають достатній розмір для зручної взаємодії.

*   **PWA-сумісність:** Застосунок відповідає стандартам Progressive Web App, що дозволяє його "встановлювати" на головний екран смартфона. Це забезпечує швидкий запуск, іконку як у нативного додатку та повноекранний режим роботи.

*   **Офлайн-можливості:** Як нефункціональна вимога, додаток повинен граційно поводитися за відсутності мережі. Користувач має отримувати чіткий зворотний зв'язок про офлайн-статус, а всі дії, виконані в цьому режимі, надійно зберігаються в локальній черзі для подальшої синхронізації.

*   **Доступність (Accessibility):** Цільовий рівень — WCAG 2.1 AA. Це включає підтримку клавіатурної навігації, сумісність з екранними дикторами (завдяки правильному використанню ARIA-атрибутів), достатню контрастність кольорів та читабельні шрифти.

*   **Інтуїтивність:** Інтерфейс має бути зрозумілим для користувачів без технічної підготовки. Максимум 3 кліки до будь-якої важливої функції. Помилки валідації та інші сповіщення мають бути чіткими та корисними.

## 9.6. Сумісність (Compatibility)

| Платформа | Підтримувані версії | Примітки |
|---|---|---|
| **Браузери** | Chrome 90+, Firefox 88+, Safari 14+, Edge 90+ | IE11 не підтримується. |
| **Мобільні ОС** | iOS 14+, Android 10+ | Через мобільні браузери та PWA. |
| **Розміри екранів** | Від 360px по ширині до 4K | Адаптивний дизайн. |

## 9.7. Дотримання лімітів безкоштовних тарифів (MVP)

Ключова нефункціональна вимога для MVP — працювати в межах безкоштовних лімітів Vercel та Supabase.
*   **База даних:** Зберігання до 500 МБ. Великі файли (зображення, документи) зберігатимуться в Supabase Storage (1 ГБ безкоштовно), а не в БД.
*   **Пропускна здатність:** Оптимізація зображень (WebP), кешування на CDN та на клієнті для зменшення трафіку.
*   **Виклики функцій:** Уникнення нескінченних циклів та занадто частого опитування (polling). Пріоритет надається Realtime-підпискам та webhooks.

## 9.8. Підтримуваність та розширюваність (Maintainability & Extensibility)

Ми закладаємо основи для довгострокового розвитку продукту, тому підтримуваність коду є одним з ключових пріоритетів.

*   **Якість коду:** Весь код пишеться на TypeScript у строгому режимі. Конфігурація ESLint та Prettier забезпечує єдиний стиль коду та допомагає уникати поширених помилок.

*   **Архітектура (Feature-Sliced Design):** Проєкт дотримується методології **Feature-Sliced Design (FSD)**. Це не просто структура папок, а філософія, що дозволяє:
    *   **Ізолювати функціонал:** Кожна бізнес-функція (наприклад, "Клієнти" або "Угоди") є самодостатнім модулем ("слайсом"). Це означає, що зміни в одному модулі мають мінімальний вплив на інші, що знижує ризик регресій.
    *   **Спростити навігацію:** Розробнику легко знайти весь код, пов'язаний з певною функцією, оскільки він згрупований в одному місці.
    *   **Спростити паралельну розробку:** Різні команди або розробники можуть одночасно працювати над різними "слайсами" з мінімальними конфліктами при злитті коду.
    *   **Контролювати залежності:** FSD чітко регламентує, як модулі можуть взаємодіяти між собою (лише через публічний API), що запобігає хаотичним зв'язкам та "спагеті-коду".

*   **Розширюваність:** Система спроєктована для легкого додавання нових функцій та інтеграцій.
    *   **Модульність:** Завдяки FSD, додавання нового великого модуля (наприклад, "Складський облік") не вимагає перебудови всього додатку.
    *   **Feature Flags:** Функціонал для різних тарифних планів буде реалізовано через "перемикачі функцій" (feature flags), що дозволить динамічно вмикати або вимикати можливості для різних організацій без необхідності розгортати нову версію коду.
    *   **API-орієнтований дизайн:** Внутрішні сервіси проєктуються так, щоб їх у майбутньому було легко виставити назовні як публічне API.

*   **Тестування:** Цільове покриття коду тестами — понад 70%. Використання юніт-тестів для бізнес-логіки (утиліти, сервіси) та інтеграційних/e2e тестів (напр., за допомогою Playwright) для ключових користувацьких сценаріїв.

*   **Моніторинг та логування:** На етапі MVP використовуються вбудовані інструменти Vercel та Supabase. Важливо враховувати, що на безкоштовних тарифах термін зберігання логів обмежений (1 година для Vercel та 24 години для Supabase), що достатньо для оперативного налагодження, але не для довгострокового аналізу.

## 9.9. Приватність та Захист Даних (Privacy & Data Protection)

Приватність даних користувачів є фундаментальною вимогою. Система розробляється з дотриманням принципів "Privacy by Design" відповідно до GDPR та Закону України "Про захист персональних даних".

*   **Мінімізація даних:** Ми збираємо та зберігаємо лише ту інформацію, яка є абсолютно необхідною для роботи CRM.
*   **Конфіденційність:** Персональні дані (імена, контакти) захищені від несанкціонованого доступу як на рівні архітектури (RLS), так і на рівні фізичного зберігання (шифрування).
*   **Реалізація прав користувачів:** Система надасть інструменти для виконання запитів на експорт (право на портативність) та видалення (право на забуття) даних.
*   **Прозорість:** Уся політика щодо обробки даних буде чітко викладена в Політиці Конфіденційності та Договорі про обробку даних (DPA).
