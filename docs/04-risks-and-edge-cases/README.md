# Розділ 4: Ризики та Крайні Випадки (Edge Cases)

Заздалегідь продумані ризики та нестандартні ситуації дозволяють розробити стратегії їхньої обробки та уникнути несподіванок під час розробки та експлуатації продукту.

### Перевищення лімітів безкоштовних тарифів
*   **Моніторинг:** Постійний контроль за використанням ресурсів (розмір БД, трафік, виклики функцій) через панелі Vercel та Supabase.
*   **Оптимізація:** Ефективні запити до БД, пагінація, стиснення зображень.
*   **Сповіщення:** Налаштування внутрішніх сповіщень при наближенні до лімітів.
*   **План оновлення:** Готовність швидко перейти на платний тариф Supabase ($25/міс) у разі потреби.

### "Холодні старти" та простої сервісів
*   **"Keep-alive" запити:** Налаштування зовнішнього сервісу моніторингу, який буде періодично "пінгувати" додаток, щоб запобігти його "засинанню".
*   **Індикатори завантаження:** Показ спіннерів або скелетних елементів, щоб користувач розумів, що процес іде, а не "завис".
*   **Кешування:** Service Worker покаже закешовану версію, поки сервери "прокидаються".

### Конфлікти даних при офлайн-синхронізації
*   **Стратегія за замовчуванням:** Для MVP використовується підхід "Last Write Wins" (останній запис перемагає).
*   **Детекція конфліктів:** При синхронізації система порівнює `updated_at` локальної та серверної версій. Якщо вони не збігаються, фіксується конфлікт.
*   **Сповіщення (майбутнє):** У майбутньому — показувати користувачеві обидві версії даних для ручного вирішення конфлікту. В MVP конфлікт просто логується.

### Помилки під час синхронізації
*   **Надійна обробка помилок:** Якщо операція з черги синхронізації завершується помилкою (напр., спроба створити замовлення для видаленого клієнта), вона не видаляється з черги.
*   **Зворотний зв'язок:** Операція позначається як "помилкова", а користувач отримує сповіщення з можливістю виправити дані та повторити спробу.

### Порушення безпеки (витік даних)
*   **Ретельне тестування RLS:** Перевірка того, що політики безпеки на рівні рядків надійно ізолюють дані різних організацій.
*   **Принцип найменших привілеїв:** Клієнтський код завжди використовує JWT користувача з обмеженими правами. Сервісний ключ використовується тільки на сервері.
*   **Санітизація та валідація:** Валідація всіх вхідних даних на сервері для запобігання ін'єкціям. Заборона рендерингу сирого HTML від користувача.
*   **План реагування:** Наявність процедури швидкої ротації секретних ключів та інформування клієнтів у разі інциденту.

### Невідповідність законодавству (GDPR, ЗУ "Про захист ПД")
*   **Мінімізація:** Обмеження збору даних лише необхідними для роботи CRM. Наявність публічної Політики Конфіденційності та DPA.
*   **Інструменти для комплаєнсу:** Реалізація функцій експорту та видалення даних для виконання прав користувачів.
*   **Відповідальність:** Чітке розмежування в Умовах Надання Послуг, що клієнт є контролером даних і несе відповідальність за законність їх збору.

### Збої в роботі зовнішніх інтеграцій (Нова Пошта)
*   **Граційна деградація:** Якщо API Нової Пошти недоступний, відповідна функція (напр., генерація ТТН) тимчасово блокується з повідомленням для користувача, але решта CRM продовжує працювати.
*   **Можливість ручного введення:** Дозволити користувачеві вручну ввести номер ТТН, якщо автоматична генерація не спрацювала.
*   **Логування помилок:** Фіксація помилок від зовнішніх API для швидкої діагностики.

### Крайні випадки в UX/UI
*   **Незрозумілі стани:** Індикатор офлайн-режиму може бути неочевидним, через що користувач не зрозуміє, що дані застаріли. **Рішення:** чіткі візуальні підказки (банер "Офлайн-режим"), іконки для несинхронізованих записів.
*   **Повільна робота списків:** При великій кількості записів (сотні клієнтів) списки можуть працювати повільно. **Рішення:** реалізація пагінації або віртуалізації списків.
*   **Обробка некоректних даних:** Введення занадто довгих імен або спеціальних символів може зламати верстку. **Рішення:** валідація на клієнті та сервері, обмеження довжини полів, коректна обробка переповнення тексту в CSS.

### Непередбачуване використання системи
*   **Зберігання великих даних:** Користувачі можуть спробувати зберігати великі об'єми тексту або base64-зображення в текстових полях. **Рішення:** встановлення серверних лімітів на розмір даних у полях.
*   **Нестандартні бізнес-запити:** Запити на функціонал, не передбачений в UI (напр., злиття двох акаунтів). **Рішення:** на етапі MVP такі запити обробляються вручну через підтримку та враховуються при плануванні майбутніх функцій.

### Ризик невиконання проєкту в строк
*   **Пріоритезація:** Суворе дотримання рамок MVP. Найважливіші функції (CRUD клієнтів/угод) реалізуються в першу чергу.
*   **Ітеративність:** Постійна наявність працюючої версії продукту, навіть з обмеженим функціоналом.
*   **Гнучкість:** Якщо реалізація якоїсь функції (напр., офлайн-синхронізація) виявляється надто складною, її обсяг для MVP може бути зменшено (напр., тільки кешування для читання).

### Ризики міграції даних при масштабуванні
*   **Ризик:** При майбутньому переїзді на власні сервери існує ризик втрати даних або тривалого простою системи, якщо процес міграції буде виконано некоректно.
*   **Стратегія обробки:** Суворе дотримання детального плану міграції (описаного в Розділі 15), який передбачає повне резервне копіювання, тестування процесу відновлення на проміжному середовищі та проведення міграції в період мінімального навантаження.
